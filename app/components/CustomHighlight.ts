import { Node } from "@tiptap/core";
import type { MentionInfo } from "~/types";

export const CustomHighlight = Node.create({
  name: "highlight_element",
  group: "inline",
  inline: true,

  addOptions() {
    return {
      mentionInfos: [],
    };
  },

  addAttributes() {
    return {
      highlightElementId: {
        default: null,
      },
      parentId: {
        default: null,
      },
    };
  },

  parseHTML() {
    return [
      {
        tag: 'span[contenteditable="false"]',
      },
    ];
  },

  renderHTML({ HTMLAttributes }) {
    const mentionInfos = this.options.mentionInfos;
    const highlightElementId = HTMLAttributes.highlightElementId;
    const highlight = mentionInfos.find(
      (info: MentionInfo["data"]) => info.id === highlightElementId,
    );

    return [
      "span",
      { class: "rounded-sm text-active flex items-center" },
      [
        "svg",
        {
          viewBox: "0 0 24 24",
          xmlns: "http://www.w3.org/2000/svg",
          class: "mr-1.5 mt-0.5 h-[1.06em] fill-highlight align-text-top inline",
          style: "fill: var(--highlight-color-svg);",
        },
        [
          "path",
          {
            d: "m12 1c-2.17559 0-4.30233.64514-6.11127 1.85383-1.80894 1.2087-3.21884 2.92666-4.0514 4.93665s-1.050401 4.22172-.62596 6.35552c.42443 2.1338 1.47208 4.0938 3.01046 5.6322 1.53838 1.5383 3.49839 2.586 5.63218 3.0104 2.13379.4245 4.34549.2066 6.35549-.6259 2.01-.8326 3.728-2.2425 4.9367-4.0514 1.2087-1.809 1.8538-3.9357 1.8538-6.1113 0-1.4445-.2845-2.87494-.8373-4.20952s-1.3631-2.54721-2.3845-3.56866c-1.0215-1.02144-2.2341-1.83169-3.5687-2.3845-1.3346-.5528-2.765-.83732-4.2095-.83732zm0 19.8c-1.7405 0-3.44186-.5161-4.88902-1.4831-1.44715-.9669-2.57506-2.3413-3.24112-3.9493-.66605-1.608-.84032-3.3774-.50077-5.0844.33955-1.70703 1.17767-3.27504 2.40837-4.50574 1.23071-1.2307 2.79872-2.06882 4.50574-2.40837 1.707-.33955 3.4764-.16528 5.0844.50077s2.9824 1.79397 3.9493 3.24112c.967 1.44715 1.4831 3.14852 1.4831 4.88902 0 2.3339-.9271 4.5722-2.5775 6.2225-1.6503 1.6504-3.8886 2.5775-6.2225 2.5775z",
          },
        ],
        [
          "path",
          {
            d: "m7.29346 19.4355.90077-4.8041c.17736-.9459 1.00331-1.6314 1.96577-1.6314h3.6803c.9624 0 1.7883.6855 1.9657 1.6314l.9008 4.8042c-1.3647.8637-.0684 1.5427-1.7067 1.5644l-.2686-1.2466-.8912-4.7534h-3.6803l-.89128 4.7534-.2686 1.2466c-1.62721-.0216-.33275-.6948-1.70666-1.5645z",
          },
        ],
        [
          "path",
          {
            d: "m11.0551 8.72772c.3107-.89689 1.5791-.89689 1.8898 0l1.1934 3.44498c.225.6496-.2574 1.3273-.9449 1.3273h-2.3868c-.6875 0-1.16991-.6777-.94488-1.3273z",
          },
        ],
      ],
      [
        "span",
        {
          class: "text-middle-hard-grey flex items-center",
        },
        highlight?.sourceTitle || "Untitled Source",
        [
          "svg",
          {
            viewBox: "0 0 16 16",
            xmlns: "http://www.w3.org/2000/svg",
            class: "mx-1 -mb-px size-4 fill-middle-grey rotate-90",
          },
          [
            "path",
            {
              d: "m13.5844 7.52666-5.11108-5.11111c-.0634-.06069-.13816-.10827-.22-.14-.16231-.06668-.34436-.06668-.50667 0-.08183.03173-.15659.07931-.21999.14l-5.11112 5.11111c-.06216.06216-.11146.13595-.1451.21717-.03364.08121-.05096.16826-.05096.25616 0 .17754.07053.3478.19606.47334.12554.12553.2958.19606.47334.19606.17753 0 .34779-.07053.47333-.19606l3.97111-3.97778v8.61555c0 .1768.07024.3464.19526.4714.12503.125.2946.1953.47141.1953s.34638-.0703.4714-.1953c.12503-.125.19527-.2946.19527-.4714v-8.61555l3.97114 3.97778c.0619.06248.1357.11208.2169.14592.0813.03385.1684.05128.2564.05128s.1751-.01743.2564-.05128c.0812-.03384.155-.08344.2169-.14592.0625-.06198.1121-.13571.146-.21695.0338-.08124.0512-.16838.0512-.25639 0-.088-.0174-.17514-.0512-.25638-.0339-.08124-.0835-.15497-.146-.21695z",
            },
          ],
        ],
        highlight?.title || "Untitled Highlight",
      ],
    ];
  },
});

export default CustomHighlight;
