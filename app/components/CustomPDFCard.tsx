import { Node } from "@tiptap/core";
import type { MentionInfo } from "~/types";

export const CustomPDFCard = Node.create({
  name: "pdf_card",
  group: "inline",
  inline: true,

  addOptions() {
    return {
      mentionInfos: [],
    };
  },

  addAttributes() {
    return {
      pdfCardId: {
        default: null,
      },
      parentId: {
        default: null,
      },
    };
  },

  parseHTML() {
    return [
      {
        tag: 'span[contenteditable="false"]',
      },
    ];
  },

  renderHTML({ HTMLAttributes }) {
    const mentionInfos = this.options.mentionInfos;
    const pdfCardId = HTMLAttributes.pdfCardId;
    const pdfCard = mentionInfos.find((info: MentionInfo["data"]) => info.id === pdfCardId);

    return [
      "span",
      { class: "rounded-sm text-active" },
      [
        "svg",
        {
          fill: "none",
          viewBox: "0 0 14 14",
          xmlns: "http://www.w3.org/2000/svg",
          class: "mr-1.5 mt-0.5 h-[1.06em] align-text-top inline",
          style: "fill: var(--middle-hard-grey);",
        },
        [
          "path",
          {
            d: "m6.54662 4.79613c.06482-.25926.12963-.38889.12963-.58333v-.12963c.06482-.32407.06482-.58333 0-.64815 0 0 0 0 0-.06481l-.06481-.06482s0 .06482-.06482.06482c-.12963.38889-.12963.84259 0 1.42592zm-1.94444 4.47223c-.12963.06481-.25926.12963-.32408.19444-.4537.38889-.77777.8426-.84259 1.037.38889-.0648.77778-.4537 1.16667-1.23144zm5.96292-.97223c-.0648-.06481-.324-.25926-1.23144-.25926h-.12963v.06482c.4537.19444.90737.32407 1.23147.32407h.1296.0649s0 0 0-.06481c0 0-.0649 0-.0649-.06482zm.9723-7.12963h-9.07411c-.71296 0-1.2963.58334-1.2963 1.2963v9.0741c0 .7129.58334 1.2963 1.2963 1.2963h9.07411c.7129 0 1.2963-.5834 1.2963-1.2963v-9.0741c0-.71296-.5834-1.2963-1.2963-1.2963zm-.713 7.64815c-.1296.06482-.3241.12963-.5833.12963-.51855 0-1.29633-.12963-1.94448-.4537-1.10185.12963-1.94444.25926-2.59259.51852-.06482 0-.06482 0-.12963.06481-.77778 1.36109-1.42593 2.00929-1.94444 2.00929-.12963 0-.19445 0-.25926-.0648l-.32408-.1945v-.0648c-.06481-.1296-.06481-.1944-.06481-.3241.06481-.3241.4537-.90739 1.23148-1.36109.12963-.06481.32407-.19444.58333-.32407.19445-.32408.38889-.71297.64815-1.16667.32407-.64815.51852-1.2963.71296-1.87963-.25926-.77778-.38889-1.23148-.12963-2.13889.06482-.25926.25926-.51852.51852-.51852h.12963c.12963 0 .25926.06482.38889.12963.4537.45371.25926 1.49074 0 2.33334v.06481c.25926.71296.64815 1.2963 1.03704 1.68519.19444.12963.32407.25926.58333.38889.32407 0 .58333-.06482.84259-.06482.7778 0 1.2963.12963 1.4907.4537.0649.12963.0649.25926.0649.38889-.0649.06482-.1297.25926-.2593.38889zm-4.21296-2.52778c-.12963.45371-.38889.97223-.64815 1.55556-.12963.25926-.25926.4537-.38889.71296h.06481.06482c.84259-.32407 1.62037-.51852 2.13889-.58333-.12963-.06482-.19445-.12963-.25926-.19445-.32408-.38888-.71296-.9074-.97222-1.49074",
          },
        ],
      ],
      [
        "span",
        {
          class: "border-b-solid border-b border-light-grey text-active",
        },
        pdfCard?.title || "Untitled PDF",
      ],
    ];
  },
});

export default CustomPDFCard;
